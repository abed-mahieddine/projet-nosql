{% extends "base.html" %}

{% block content %}
<div class="header-bar">
    <div>
        <h1 class="page-title">Tableau de bord</h1>
        <p class="page-subtitle">Surveillance des équipements en temps réel</p>
    </div>
    
    <div class="status-badge">
        <i class="fa-solid fa-triangle-exclamation"></i>
        <span>Alertes critiques : {{ alert_count }}</span>
    </div>
</div>

<div class="grid-container">
    {% for machine in machines %}
    <div class="card st-{{ machine.status }}">
        <div class="card-header">
            <span class="machine-name"><i class="fa-solid fa-industry"></i> {{ machine.id }}</span>
            <span class="dot"></span>
        </div>
        
        <div class="metric-display">
            {{ machine.current_value }}<span class="unit">{{ '°C' if machine.metric == 'Temperature' else 'Bar' }}</span>
        </div>
        
        <div class="meta-info">
            <span>Statut : <strong>{{ machine.status }}</strong></span>
            <span><i class="fa-regular fa-clock"></i> {{ machine.last_seen.split(' ')[1] if ' ' in machine.last_seen else 'Aucune donnée' }}</span>
        </div>
    </div>
    {% endfor %}
</div>

<div class="panel">
    <h3 class="panel-title"><i class="fa-solid fa-sliders"></i> Saisie de données</h3>
    <form method="POST" class="control-form">
        <div class="form-group">
            <label><i class="fa-solid fa-industry"></i> Équipement</label>
            <select name="machine_id" class="form-control">
                <option value="Machine-A1">Machine-A1 - Four industriel</option>
                <option value="Machine-B2">Machine-B2 - Presse hydraulique</option>
                <option value="Machine-C3">Machine-C3 - Système de refroidissement</option>
            </select>
        </div>
        <div class="form-group">
            <label><i class="fa-solid fa-gauge-high"></i> Type de mesure</label>
            <select name="metric_type" class="form-control">
                <option value="Temperature">Température (°C)</option>
                <option value="Pression">Pression (Bar)</option>
            </select>
        </div>
        <div class="form-group">
            <label><i class="fa-solid fa-sensor"></i> Valeur mesurée</label>
            <input type="number" step="0.1" name="value" placeholder="Ex: 85.5" class="form-control" required>
        </div>
        <button type="submit" class="btn-primary">
            <i class="fa-solid fa-upload"></i> Enregistrer la mesure
        </button>
    </form>
</div>

<div class="panel">
    <h3 class="panel-title"><i class="fa-solid fa-database"></i> Historique des mesures</h3>
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th><i class="fa-solid fa-clock"></i> Horodatage</th>
                    <th><i class="fa-solid fa-industry"></i> Équipement</th>
                    <th><i class="fa-solid fa-gauge-high"></i> Valeur mesurée</th>
                    <th><i class="fa-solid fa-circle-exclamation"></i> Statut</th>
                </tr>
            </thead>
            <tbody>
                {% if logs %}
                    {% for log in logs %}
                    <tr>
                        <td style="font-family: 'Courier New', monospace; color: var(--text-secondary); font-size: 0.875rem;">{{ log.timestamp }}</td>
                        <td><strong>{{ log.machine_id }}</strong></td>
                        <td>{{ log.value }} <span style="color: var(--text-muted);">{{ '°C' if log.metric == 'Temperature' else 'Bar' }}</span></td>
                        <td><span class="badge bg-{{ log.status }}">{{ log.status }}</span></td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="4" style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                            <i class="fa-solid fa-inbox"></i> Aucune donnée enregistrée
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

